(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{285:function(e,t,n){var content=n(289);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(29).default)("0a18e831",content,!0,{sourceMap:!1})},286:function(e,t,n){var content=n(291);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(29).default)("20035751",content,!0,{sourceMap:!1})},287:function(e,t,n){"use strict";var o={name:"PageHeaderItem"},l=(n(288),n(16)),component=Object(l.a)(o,(function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"page-header-item"},[this._t("default")],2)}),[],!1,null,null,null);t.a=component.exports},288:function(e,t,n){"use strict";var o=n(285);n.n(o).a},289:function(e,t,n){(t=n(28)(!1)).push([e.i,".page-header-item{flex:0 1 auto;padding-top:4px;padding-bottom:4px;background:#c2cfd6;display:flex;padding-left:.5rem;overflow:visible;height:30px;min-height:30px;max-height:30px;min-width:20px}.page-header-item .btn{height:30px;padding:4px}.page-header-item *{height:30px;max-height:30px;margin-right:4px}.header-button-icon{width:30px;font-size:14px;display:flex}.header-button-icon i{max-height:22px;max-width:22px;margin:0;padding:4px 0 0;flex-shrink:1;flex-grow:1}",""]),e.exports=t},290:function(e,t,n){"use strict";var o=n(286);n.n(o).a},291:function(e,t,n){(t=n(28)(!1)).push([e.i,".page-header{flex-grow:0!important;flex-shrink:0!important;height:38px!important;margin-bottom:0!important;border-bottom:0!important;border-radius:0!important;width:calc(100vw - 120px);display:flex;flex-direction:row;background:#c2cfd6;overflow:visible}",""]),e.exports=t},292:function(e,t,n){var content=n(307);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(29).default)("cda4275e",content,!0,{sourceMap:!1})},293:function(e,t,n){"use strict";var o={name:"PageHeader",props:{},components:{PageHeaderItem:n(287).a},methods:{}},l=(n(290),n(16)),component=Object(l.a)(o,(function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"page-header"},[this._t("default")],2)}),[],!1,null,null,null);t.a=component.exports},295:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return l}));n(42),n(2),n(1),n(305),n(7);function o(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return new TextDecoder(n).decode(e.from(Object.values(t)))}function l(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=new Date(0);return t.setSeconds(e,e%1*1e3),t.toISOString().substr(14,8)}}).call(this,n(301).Buffer)},306:function(e,t,n){"use strict";var o=n(292);n.n(o).a},307:function(e,t,n){(t=n(28)(!1)).push([e.i,".vue-slider{padding:4px}.vue-slider-rail{background:#f0f3f5!important}.vue-slider-dot{background:#1985ac;border-radius:50%}.slider-container{display:flex;flex-direction:row;padding-top:4px;padding-left:4px;padding-right:4px}.slider-caption{height:14px;margin-bottom:4px}",""]),e.exports=t},308:function(e,t,n){"use strict";var o=n(13),l=n(21),r=n(295),c=n(333),d=n.n(c),h=n(287),f=n(302),m=n(319),v=n.n(m);n(8).default.use(v.a);var w={name:"PageHeaderSeek",props:{id:{type:String,default:"",required:!0}},components:{VueSlider:d.a,PageHeaderItem:h.a},beforeMount:function(){var e=this;this.resetSeekPosition(),Object(o.v)(this.id).then((function(t){e.totalSeconds=t})),this.$root.$on(l.a.seek.set(this.id),this.handleSeek),this.$root.$on(l.a.seek.reset(this.id),this.resetSeekPosition),this.$root.$on(l.a.seek.step_fw(this.id),this.stepForward),this.$root.$on(l.a.seek.step_bw(this.id),this.stepBackward)},beforeDestroy:function(){this.position=null,clearInterval(this.syncInterval),this.$root.$off(l.a.seek.set(this.id),this.handleSeek),this.$root.$off(l.a.seek.reset(this.id),this.resetSeekPosition),this.$root.$off(l.a.seek.step_fw(this.id),this.stepForward),this.$root.$off(l.a.seek.step_bw(this.id),this.stepBackward)},methods:{setSeekPosition:function(){var e=this;Object(o.A)(this.id,this.position).then((function(t){e.position=t}))},handleSeek:Object(f.b)(100,!0,Object(f.a)(25,!0,(function(){this.setSeekPosition()}))),resetSeekPosition:function(){console.log("PageHeaderSeek(".concat(this.id,".resetSeek()")),this.position=null,this.handleSeek()},stepForward:function(){this.position=this.position+this.step,this.handleSeek()},stepBackward:function(){this.position=this.position-this.step,this.handleSeek()}},computed:{keymap:function(){return{right:this.stepForward,left:this.stepBackward}},currentTime:function(){return Object(r.b)(this.position*this.totalSeconds)},totalTime:function(){return Object(r.b)(this.totalSeconds)}},data:function(){return{position:null,step:.01,options:{dotSize:14,width:120,height:4,contained:!1,direction:"ltr",data:null,min:0,max:1,interval:.01,disabled:!1,clickable:!0,duration:.05,adsorb:!1,lazy:!1,tooltip:"inactive",tooltipPlacement:"bottom",tooltipFormatter:this.formatTooltip,useKeyboard:!0,keydownHook:null,dragOnClick:!1,enableCross:!0,fixed:!1,order:!0,marks:!1,process:!1},syncInterval:null,totalSeconds:0}}},k=(n(306),n(16)),component=Object(k.a)(w,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("PageHeaderItem",[n("div",{staticClass:"slider-container"},[n("div",{staticClass:"slider-caption"},[e._v(e._s(e.currentTime)+" / "+e._s(e.totalTime))]),e._v(" "),e._v("\n     \n    "),n("vue-slider",e._b({ref:"slider",on:{change:e.handleSeek},model:{value:e.position,callback:function(t){e.position=t},expression:"position"}},"vue-slider",e.options,!1))],1)])}),[],!1,null,null,null);t.a=component.exports},335:function(e,t,n){var content=n(622);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(29).default)("1ff3331c",content,!0,{sourceMap:!1})},621:function(e,t,n){"use strict";var o=n(335);n.n(o).a},622:function(e,t,n){(t=n(28)(!1)).push([e.i,".align{float:left;margin:0;height:calc(100vh - 38px);width:calc(100vw - 120px);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none}.align,.streamed-image-a{position:absolute;display:block}.streamed-image-a{z-index:-100;pointer-events:none;max-width:calc(100vw - 120px);max-height:calc(100vh - 38px);width:auto;height:auto}.moveable{position:absolute;width:100px;height:100px;left:0;top:0;margin:0}.hidden *{visibility:hidden}.moveable-control,.moveable-line{border-color:#1e9ecb!important;background:#20a8d8!important}.moveable-line{visibility:hidden!important}.moveable-control.moveable-rotation{border-color:#1e9ecb!important;background:#ade1f3!important}.moveable-direction,.moveable-rotation-line{visibility:visible!important;outline:1px solid transparent!important}",""]),e.exports=t},637:function(e,t,n){"use strict";n.r(t);n(1),n(42);var o=n(7),l=n(13),r=n(620),c=n.n(r),d=n(128),h=n(21),f=n(293),m=n(287),v=n(308),w=n(302),k=n(319),x=n.n(k);n(8).default.use(x.a);var _={name:"analyzer-align",beforeMount:function(){this.handleInit(),window.onresize=this.updateFrame},beforeDestroy:function(){this.handleSaveAlignment(),this.handleCleanUp()},components:{Moveable:c.a,PageHeader:f.a,PageHeaderItem:m.a,PageHeaderSeek:v.a},methods:{handleInit:function(){var e=this;console.log("align: handleInit()"),this.previous_id=this.id,this.opened_at=Date.now(),-1===this.$store.getters["analyzers/getIndex"](this.id)?this.$router.push("/"):(this.$root.$emit(h.a.sidebar.open(this.id)),this.align.flip=this.$store.getters["analyzers/getConfig"](this.id).transform.flip,this.waitUntilHasRect=setInterval(this.updateFrameOnceHasRect,100),Object(l.r)("transform").then((function(t){e.transform_options=t,e.transform=t[0]})),Object(l.s)(this.id).then((function(t){e.setRoi(t),e.$root.$emit(h.a.seek.reset(e.id))})),this.handleUpdate())},handleCleanUp:function(){console.log("align: handleCleanUp()"),Object(l.J)(this.previous_id,l.l.GET_INVERSE_OVERLAID_FRAME),clearInterval(this.waitUntilHasRect),this.align={frame:null,roi:null,transform:null,overlay:{width:100,height:100,top:-50,left:-50,bottom:50,right:50}}},handleClearAlignment:function(){var e=this;console.log("align: handleClearAlignment"),Object(l.k)(this.id).then((function(t){t&&Object(l.j)(e.id).then((function(t){t&&(e.handleHideMoveable(),e.clearRoi,e.handleUpdate())}))}))},handleSaveAlignment:function(){Object(l.k)(this.previous_id)},handleUndoAlignment:function(){var e=this;Object(l.K)(this.id).then((function(t){e.setRoi(t)}))},handleRedoAlignment:function(){var e=this;Object(l.y)(this.id).then((function(t){e.setRoi(t)}))},setRoi:function(e){var t=this;console.log("filter: setRoi()"),console.log("roi"),console.log(e),this.align.roi!==e&&(Object(d.d)(e)?(console.log("is valid"),this.moveableShow?(this.align.roi=e,this.resolveTransform()):this.handleShowMoveable().then((function(){console.log("setRoi() -- moveable should be exist & accessible"),t.align.roi=e,t.resolveTransform(),t.handleUpdate()}))):(console.log("is invalid"),console.warn("SHOULD ALLOW USER TO DRAW A RECTANGLE"),this.handleHideMoveable()))},clearRoi:function(){console.log("filter: clearRoi()"),this.handleHideMoveable(),this.align.roi=null,this.align.transform=null},resolveTransform:function(){var e=this;console.log("filter: resolveTransform()"),console.log("this.$refs.moveable = "),console.log(this.$refs.moveable),this.align.roi&&this.align.frame&&this.align.overlay&&(clearInterval(this.waitUntilHasMoveable),console.log("roi.BL = (x: ".concat(this.align.roi.BL.x,", y: ").concat(this.align.roi.BL.y,")")),console.log("frame = "),console.log(this.align.frame),console.log("overlay = "),console.log(this.align.overlay),this.align.transform=Object(d.c)(this.align.roi,this.align.frame,this.align.overlay),this.moveableShow&&(void 0===this.$refs.moveable?this.waitUntilHasMoveable=setInterval((function(){void 0!==e.$refs.moveable?(e.$refs.moveable.$el.style.transform=e.align.transform,e.$refs.moveable.updateRect(),e.$refs.moveable.updateTarget(),clearInterval(e.waitUntilHasMoveable)):console.log("oops no moveable")}),50):(this.$refs.moveable.$el.style.transform=this.align.transform,this.$refs.moveable.updateRect(),this.$refs.moveable.updateTarget())))},handleTransform:function(e){var t=e.target,n=e.transform;t.style.transform=n},handleRotate:function(e){var t=e.target,n=e.transform;t.style.transform=n},handleFlipH:function(){var e=this;this.$store.dispatch("analyzers/set_config",{id:this.id,config:{transform:{flip:[this.align.flip[0],!this.align.flip[1]]}}}).then((function(t){e.align.flip=t.transform.flip}))},handleFlipV:function(){var e=this;this.$store.dispatch("analyzers/set_config",{id:this.id,config:{transform:{flip:[!this.align.flip[0],this.align.flip[1]]}}}).then((function(t){e.align.flip=t.transform.flip}))},handleTurnCW:function(){console.log("align.handleTurnCW()"),this.$store.dispatch("analyzers/turn",{id:this.id,direction:"CW"})},handleTurnCCW:function(){console.log("align.handleTurnCCW()"),this.$store.dispatch("analyzers/turn",{id:this.id,direction:"CCW"})},updateRoiCoordinates:function(){var e=this;console.log("align: updateRoiCoordinates"),this.align.frame&&(this.align.roi=Object(d.e)(this.$refs.moveable.getRect(),this.align.frame),void 0!==this.align.roi&&(this.report_change?Object(l.H)(this.id).then((function(){Object(l.m)(e.id,e.align.roi)})):Object(l.m)(this.id,this.align.roi)))},handleUpdate:Object(w.b)(100,!1,Object(w.a)(20,!1,(function(){this.updateRoiCoordinates()}))),updateFrame:function(){console.log("align: updateFrame");try{var e=this.$refs.frame.getBoundingClientRect();this.moveable.bounds={left:e.left,right:e.right,top:e.top,bottom:e.bottom},this.align.frame=e,this.resolveTransform()}catch(e){console.log("oops @ updateFrame")}},updateFrameOnceHasRect:function(){try{void 0!==this.waitUntilHasRect&&this.$refs.frame.getBoundingClientRect().width>50&&(this.updateFrame(),clearInterval(this.waitUntilHasRect))}catch(e){console.log("oops @ updateFrameOnceHasRect")}},stepForward:function(){this.$root.$emit(h.a.seek.step_fw(this.id))},stepBackward:function(){this.$root.$emit(h.a.seek.step_bw(this.id))},handleShowMoveable:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("align: handleShowMoveable()"),t.abrupt("return",new Promise((function(t,n){e.moveableShow=!0;var o=setInterval((function(){console.log("checking if moveable exists"),void 0!==e.$refs.moveable&&(console.log("it does, resolving"),clearInterval(o),t())}),5)})));case 2:case"end":return t.stop()}}),t)})))()},handleHideMoveable:function(){console.log("align: handleHideMoveable()"),this.moveableShow=!1},handleStartRectangle:function(e){console.log("align: handleStartRectangle"),this.moveableShow||(this.dragROI.started=!0,this.dragROI.start_event=e)},handleStopRectangle:function(e){if(console.log("align: handleStopRectangle()"),!this.moveableShow&&this.dragROI.started){console.log("align: handleStopRectangle() -- setting ROI");var t=Object(d.b)(this.dragROI.start_event,e,this.align.frame);null!==t&&this.setRoi(t)}else console.log("align: handleStopRectangle() -- moveable is already shown!")}},watch:{"$route.query.id":function(){console.log("id changed to ".concat(this.id)),this.handleCleanUp(),this.handleInit()},"$refs.moveable.$el":function(){console.warn("there was a change in $ref.moveable.data"),console.warn(this.$refs.moveable)}},computed:{id:function(){return this.$route.query.id},keymap:function(){return{"ctrl+z":this.handleUndoAlignment,"ctrl+shift+z":this.handleRedoAlignment,right:this.stepForward,left:this.stepBackward}},overlaid_url:function(){return Object(l.d)(this.$route.query.id,"stream",l.l.GET_INVERSE_OVERLAID_FRAME)},ref_frame:function(){return"frame"},ref_moveable:function(){return"moveable"},report_change:function(){var e=this.$store.getters["analyzers/getAnalyzerStatus"](this.id).state;return e===l.a.DONE||e===l.a.ERROR||e===l.a.CANCELED}},data:function(){return{opened_at:0,transform_options:{},transform:"",moveable:{draggable:!0,throttleDrag:0,rotatable:!0,throttleRotate:0,warpable:!0,throttleWarp:0,snappable:!0,bounds:{}},align:{frame:null,overlay:{width:100,height:100,top:-50,left:-50,bottom:50,right:50},roi:null,transform:null},updateCall:null,moveableShow:!1,dragROI:{start_event:{}},waitUntilHasRect:null,previous_id:""}}},y=(n(621),n(16)),component=Object(y.a)(_,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"fixed-page"},[n("PageHeader",[n("PageHeaderItem",[n("b-button",{staticClass:"header-button-icon",attrs:{"data-toggle":"tooltip",title:"Clear alignment"},on:{click:e.handleClearAlignment}},[n("i",{staticClass:"icon-ban"})]),e._v(" "),n("b-button",{directives:[{name:"hotkey",rawName:"v-hotkey",value:e.keymap,expression:"keymap"}],staticClass:"header-button-icon",attrs:{"data-toggle":"tooltip",title:"Undo alignment"},on:{click:e.handleUndoAlignment}},[n("i",{staticClass:"icon-action-undo"})]),e._v(" "),n("b-button",{directives:[{name:"hotkey",rawName:"v-hotkey",value:e.keymap,expression:"keymap"}],staticClass:"header-button-icon",attrs:{"data-toggle":"tooltip",title:"Redo alignment"},on:{click:e.handleRedoAlignment}},[n("i",{staticClass:"icon-action-redo"})])],1),e._v(" "),n("PageHeaderSeek",{key:e.id,attrs:{id:e.id}}),e._v(" "),n("PageHeaderItem",[n("b-button",{staticClass:"header-button-icon",attrs:{"data-toggle":"tooltip",title:"Flip horizontally"},on:{click:e.handleFlipH}},[n("i",{staticClass:"fa fa-arrows-h"})]),e._v(" "),n("b-button",{staticClass:"header-button-icon",attrs:{"data-toggle":"tooltip",title:"Flip vertically"},on:{click:e.handleFlipV}},[n("i",{staticClass:"fa fa-arrows-v"})])],1),e._v(" "),n("PageHeaderItem",[n("b-button",{staticClass:"header-button-icon",attrs:{"data-toggle":"tooltip",title:"Rotate 90° clockwise"},on:{click:e.handleTurnCW}},[n("i",{staticClass:"fa fa-rotate-right"})]),e._v(" "),n("b-button",{staticClass:"header-button-icon",attrs:{"data-toggle":"tooltip",title:"Rotate 90° counter-clockwise"},on:{click:e.handleTurnCCW}},[n("i",{staticClass:"fa fa-rotate-left"})])],1),e._v(" "),n("PageHeaderItem",[n("b-button-group",[n("b-dropdown",{attrs:{text:""+this.transform,"data-toggle":"tooltip",title:"Transform type"}},e._l(e.transform_options,(function(t){return n("b-dropdown-item",{key:"align-"+t},[e._v("\n            "+e._s(t)+"\n          ")])})),1)],1)],1)],1),e._v(" "),n("div",{ref:"align",staticClass:"align",on:{mousedown:e.handleStartRectangle,mouseup:e.handleStopRectangle}},[n("img",{ref:"frame",staticClass:"streamed-image-a",attrs:{src:e.overlaid_url+"?"+e.opened_at,alt:""}}),e._v(" "),e.moveableShow?[n("Moveable",e._b({ref:"moveable",staticClass:"moveable",on:{drag:e.handleTransform,scale:e.handleTransform,rotate:e.handleRotate,warp:e.handleTransform,render:e.handleUpdate,renderEnd:e.handleSaveAlignment}},"Moveable",e.moveable,!1))]:e._e()],2)],1)}),[],!1,null,null,null);t.default=component.exports}}]);