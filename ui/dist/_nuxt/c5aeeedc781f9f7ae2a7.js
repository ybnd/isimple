(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{282:function(t,e,o){var content=o(290);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(30).default)("0a18e831",content,!0,{sourceMap:!1})},283:function(t,e,o){var content=o(292);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(30).default)("20035751",content,!0,{sourceMap:!1})},284:function(t,e,o){"use strict";var n={name:"PageHeaderItem"},r=(o(289),o(16)),component=Object(r.a)(n,(function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"page-header-item"},[this._t("default")],2)}),[],!1,null,null,null);e.a=component.exports},285:function(t,e,o){var content=o(301);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(30).default)("cda4275e",content,!0,{sourceMap:!1})},289:function(t,e,o){"use strict";var n=o(282);o.n(n).a},290:function(t,e,o){(e=o(29)(!1)).push([t.i,".page-header-item{flex:0 1 auto;margin-bottom:7px;margin-top:8px;background:#c2cfd6;display:block;padding-left:.5rem;overflow:visible;height:34.9333px;min-height:34.9333px;max-height:34.9333px;min-width:20px}.page-header-item .btn{height:34.9333px}.page-header-item *{height:34.9333px;max-height:34.9333px}.header-button-icon{width:34.9333px;font-size:16px;padding:4px}",""]),t.exports=e},291:function(t,e,o){"use strict";var n=o(283);o.n(n).a},292:function(t,e,o){(e=o(29)(!1)).push([t.i,".page-header{flex-grow:0!important;flex-shrink:0!important;height:49.9333px!important;margin-bottom:0!important;border-bottom:0!important;border-radius:0!important;width:calc(100vw - 120px);display:flex;flex-direction:row;background:#c2cfd6;overflow:visible}",""]),t.exports=e},293:function(t,e,o){"use strict";var n={name:"PageHeader",props:{},components:{PageHeaderItem:o(284).a},methods:{}},r=(o(291),o(16)),component=Object(r.a)(n,(function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"page-header"},[this._t("default")],2)}),[],!1,null,null,null);e.a=component.exports},300:function(t,e,o){"use strict";var n=o(285);o.n(n).a},301:function(t,e,o){(e=o(29)(!1)).push([t.i,".vue-slider{padding:4px}.vue-slider-rail{background:#f0f3f5!important}.vue-slider-dot{background:#1985ac;border-radius:50%}.slider-container{display:flex;flex-direction:column;padding-left:4px;padding-right:4px}.slider-caption{height:14px;margin-bottom:4px}",""]),t.exports=e},302:function(t,e,o){"use strict";var n=o(13),r=o(45),l=o(329),c=o.n(l),h=o(284),d=o(297),f=o(313),m=o.n(f);o(8).default.use(m.a);var k={name:"PageHeaderSeek",props:{id:{type:String,default:"",required:!0}},components:{VueSlider:c.a,PageHeaderItem:h.a},beforeMount:function(){this.resetSeekPosition(),this.$root.$on(r.a.seek.get(this.id),this.getSeekPosition),this.$root.$on(r.a.seek.set(this.id),this.handleSeek),this.$root.$on(r.a.seek.reset(this.id),this.resetSeekPosition),this.$root.$on(r.a.seek.step_fw(this.id),this.stepForward),this.$root.$on(r.a.seek.step_bw(this.id),this.stepBackward)},beforeDestroy:function(){this.position=null,clearInterval(this.syncInterval),this.$root.$off(r.a.seek.get(this.id),this.getSeekPosition),this.$root.$off(r.a.seek.set(this.id),this.handleSeek),this.$root.$off(r.a.seek.reset(this.id),this.resetSeekPosition),this.$root.$off(r.a.seek.step_fw(this.id),this.stepForward),this.$root.$off(r.a.seek.step_bw(this.id),this.stepBackward)},methods:{setSeekPosition:function(){var t=this;Object(n.C)(this.id,this.position).then((function(e){t.position=e}))},handleSeek:Object(d.b)(100,!0,Object(d.a)(25,!0,(function(){this.setSeekPosition()}))),resetSeekPosition:function(){console.log("PageHeaderSeek(".concat(this.id,".resetSeek()")),this.position=null,this.handleSeek()},stepForward:function(){this.position=this.position+this.step,this.handleSeek()},stepBackward:function(){this.position=this.position-this.step,this.handleSeek()},formatTooltip:function(t){return"".concat(Math.round(100*t),"%")}},computed:{keymap:function(){return{right:this.stepForward,left:this.stepBackward}}},data:function(){return{position:null,step:.01,options:{dotSize:14,width:120,height:4,contained:!1,direction:"ltr",data:null,min:0,max:1,interval:.01,disabled:!1,clickable:!0,duration:.05,adsorb:!1,lazy:!1,tooltip:"active",tooltipPlacement:"bottom",tooltipFormatter:this.formatTooltip,useKeyboard:!0,keydownHook:null,dragOnClick:!1,enableCross:!0,fixed:!1,order:!0,marks:!1,process:!1},syncInterval:null}}},v=(o(300),o(16)),component=Object(v.a)(k,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("PageHeaderItem",[o("div",{staticClass:"slider-container"},[o("div",{staticClass:"slider-caption"},[t._v("Seek position")]),t._v(" "),o("vue-slider",t._b({ref:"slider",on:{change:t.handleSeek},model:{value:t.position,callback:function(e){t.position=e},expression:"position"}},"vue-slider",t.options,!1))],1)])}),[],!1,null,null,null);e.a=component.exports},332:function(t,e,o){var content=o(621);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(30).default)("45a71ca0",content,!0,{sourceMap:!1})},620:function(t,e,o){"use strict";var n=o(332);o.n(n).a},621:function(t,e,o){(e=o(29)(!1)).push([t.i,".filter{float:left;margin:0}.filter,.streamed-image-f{position:absolute;display:block;max-height:calc(100vh - 49.9333px)}.streamed-image-f{z-index:100;max-width:calc(100vw - 120px);width:auto;height:auto}.overlay{mix-blend-mode:multiply}.hidden *{visibility:hidden}",""]),t.exports=e},636:function(t,e,o){"use strict";o.r(e);o(2),o(1),o(4);var n=o(13),r=o(45),l=o(293),c=o(284),h=o(302),d=o(127),f={name:"analyzer-filter",beforeMount:function(){this.handleInit(),window.onresize=this.updateFrame},beforeDestroy:function(){this.handleCleanUp()},components:{PageHeader:l.a,PageHeaderItem:c.a,PageHeaderSeek:h.a},methods:{handleInit:function(){var t=this;console.log("filter: handleInit()"),this.previous_id=this.id,this.opened_at=Date.now(),-1===this.$store.getters["analyzers/getIndex"](this.id)?this.$router.push("/"):(this.$root.$emit(r.a.sidebar.open(this.id)),this.waitUntilHasRect=setInterval(this.updateFrameOnceHasRect,100),this.waitForMasks=setInterval(this.getMasks,100),this.waitForFeatures=setInterval(this.getFeatures,100),Object(n.s)("filter").then((function(e){t.filter_options=e})),console.log("setting this.feature to ".concat(this.feature)),this.$store.dispatch("analyzers/get_config",{id:this.id}).then((function(){t.$root.$emit(r.a.seek.reset(t.id))})))},handleCleanUp:function(){console.log("filter: handleCleanUp()"),Object(n.L)(this.previous_id,n.m.GET_FRAME),Object(n.L)(this.previous_id,n.m.GET_STATE_FRAME),clearInterval(this.waitUntilHasRect),clearInterval(this.waitForFeatures),clearInterval(this.waitForMasks),this.filter={frame:null},this.refs={frame:null}},getRefs:function(){console.log("filter: getRefs()"),console.log("this.ref_frame = "),console.log(this.ref_frame),console.log("this.$refs attrs = "),console.log(Object.keys(this.$refs)),console.log("this.$refs[this.ref_frame] = "),console.log(this.$refs[this.ref_frame]),this.refs.frame=this.$refs[this.ref_frame]},getMasks:function(){console.log("filter: getMasks()"),this.masks=this.$store.getters["analyzers/getMasks"](this.id),this.mask=this.masks[0],this.filter_type=this.$store.getters["analyzers/getMaskFilterType"](this.id,0),0!==this.masks.length&&void 0!==this.masks[0]&&(console.log("filter: getMasks() -- clearing interval"),clearInterval(this.waitForMasks)),console.log(this.masks)},getFeatures:function(){console.log("filter: getFeatures()"),this.features=this.$store.getters["analyzers/getFeatures"](this.id),this.feature=this.features[0],0!==this.features.length&&(console.log("filter: getFeatures() -- clearing interval"),clearInterval(this.waitForFeatures)),console.log(this.features)},updateFrame:function(){console.log("Updating frame...");var t=this.refs.frame.getBoundingClientRect();console.log(t),this.filter.frame=t},updateFrameOnceHasRect:function(){var t=!1;this.getRefs(),void 0!==this.waitUntilHasRect&&this.refs.frame.getBoundingClientRect().width>50&&(console.log("HAS FRAME"),this.updateFrame(),t=!0),t&&clearInterval(this.waitUntilHasRect)},handleClick:function(t){Object(n.G)(this.id,Object(d.a)(t,this.filter.frame)).then((function(t){t&&console.log("//PUT THIS IN A POPUP OR SOMETHING// ".concat(t))}))},handleSetFeature:function(t){var e=this;this.$store.dispatch("analyzers/set_config",{id:this.id,config:{features:[t]}}).then((function(t){console.log("in analyzers/set_config callback");var o=e.$store.getters["analyzers/getFeatures"](e.id);e.feature=o[0]}))},handleSetMask:function(mask,t){this.mask=mask,this.filter_type=this.$store.getters["analyzers/getMaskFilterType"](this.id,t),this.filter_data=this.$store.getters["analyzers/getMaskFilterData"](this.id,t)},handleSetFilter:function(filter){var t=this,e=this.$store.getters["analyzers/getConfig"](this.id);e.masks[this.mask].filter.type=filter,this.$store.dispatch("analyzers/set_config",{id:this.id,config:e}).then((function(){t.filter_type=t.$store.getters["analyzers/getMaskFilterType"](t.id)}))},handleClearFilters:function(){console.warn("NOT IMPLEMENTED YET")},handleUndoFilters:function(){console.warn("NOT IMPLEMENTED YET")},handleRedoFilters:function(){console.warn("NOT IMPLEMENTED YET")},stepForward:function(){this.$root.$emit(r.a.seek.step_fw(this.id))},stepBackward:function(){this.$root.$emit(r.a.seek.step_bw(this.id))}},watch:{"$route.query.id":function(){console.log("id has changed ".concat(this.id)),this.$forceUpdate(),this.handleInit(),this.updateFrame()}},computed:{id:function(){return this.$route.query.id},state_url:function(){return Object(n.e)(this.$route.query.id,"stream",n.m.GET_STATE_FRAME)},frame_url:function(){return Object(n.e)(this.$route.query.id,"stream",n.m.GET_FRAME)},ref_frame:function(){return"filter-frame-".concat(this.$route.query.id)},keymap:function(){return{"ctrl+z":this.handleUndoFilters,"ctrl+shift+z":this.handleRedoFilters,right:this.stepForward,left:this.stepBackward}}},data:function(){return{opened_at:0,waitUntilHasRect:null,waitForMasks:null,waitForFeatures:null,filter_type:"",filter_options:void 0,filter_data:{},mask:"",masks:[],feature:"",features:[],filter:{frame:null},refs:{frame:null}}}},m=(o(620),o(16)),component=Object(m.a)(f,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"fixed-page"},[o("PageHeader",[o("PageHeaderItem",[o("b-button",{staticClass:"header-button-icon",attrs:{"data-toggle":"tooltip",title:"Clear alignment"},on:{click:t.handleClearFilters}},[o("i",{staticClass:"fa fa-remove"})]),t._v(" "),o("b-button",{directives:[{name:"hotkey",rawName:"v-hotkey",value:t.keymap,expression:"keymap"}],staticClass:"header-button-icon",attrs:{"data-toggle":"tooltip",title:"Undo alignment"},on:{click:t.handleUndoFilters}},[o("i",{staticClass:"fa fa-undo"})]),t._v(" "),o("b-button",{directives:[{name:"hotkey",rawName:"v-hotkey",value:t.keymap,expression:"keymap"}],staticClass:"header-button-icon",attrs:{"data-toggle":"tooltip",title:"Redo alignment"},on:{click:t.handleRedoFilters}},[o("i",{staticClass:"fa fa-repeat"})])],1),t._v(" "),o("PageHeaderSeek",{attrs:{id:t.id}}),t._v(" "),o("PageHeaderItem"),t._v(" "),o("PageHeaderItem",[o("b-button-group",[o("b-dropdown",{attrs:{text:""+this.mask,"data-toggle":"tooltip",title:"Mask"}},t._l(t.masks,(function(mask,e){return o("b-dropdown-item",{key:"mask-"+mask,on:{click:function(o){return t.handleSetMask(mask,e)}}},[t._v("\n            "+t._s(mask)+"\n          ")])})),1),t._v(" "),o("b-dropdown",{attrs:{text:""+this.filter_type,"data-toggle":"tooltip",title:"Filter type"}},t._l(t.filter_options,(function(filter){return o("b-dropdown-item",{key:"filter-"+filter,on:{click:function(e){return t.handleSetFilter(filter)}}},[t._v("\n            "+t._s(filter)+"\n          ")])})),1)],1)],1)],1),t._v(" "),o("div",{staticClass:"filter"},[o("img",{ref:t.ref_frame,staticClass:"streamed-image-f",attrs:{src:t.frame_url+"?"+t.opened_at,alt:""}}),t._v(" "),o("img",{staticClass:"streamed-image-f overlay",attrs:{src:t.state_url+"?"+t.opened_at,alt:""},on:{click:t.handleClick}})]),t._v(" "),o("div",{staticClass:"controls"})],1)}),[],!1,null,null,null);e.default=component.exports}}]);