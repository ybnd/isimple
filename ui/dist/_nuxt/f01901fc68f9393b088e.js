(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{278:function(t,e,o){var content=o(286);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(32).default)("0a18e831",content,!0,{sourceMap:!1})},279:function(t,e,o){var content=o(288);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(32).default)("20035751",content,!0,{sourceMap:!1})},280:function(t,e,o){"use strict";var n={name:"PageHeaderItem"},r=(o(285),o(16)),component=Object(r.a)(n,(function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"page-header-item"},[this._t("default")],2)}),[],!1,null,null,null);e.a=component.exports},281:function(t,e,o){var content=o(297);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(32).default)("cda4275e",content,!0,{sourceMap:!1})},285:function(t,e,o){"use strict";var n=o(278);o.n(n).a},286:function(t,e,o){(e=o(31)(!1)).push([t.i,".page-header-item{flex:0 1 auto;margin-bottom:7px;margin-top:8px;background:#c2cfd6;display:block;padding-left:.5rem;overflow:visible;height:34.9333px;min-height:34.9333px;max-height:34.9333px;min-width:20px}.page-header-item .btn{height:34.9333px}.page-header-item *{height:34.9333px;max-height:34.9333px}.header-button-icon{width:34.9333px;font-size:16px;padding:4px}",""]),t.exports=e},287:function(t,e,o){"use strict";var n=o(279);o.n(n).a},288:function(t,e,o){(e=o(31)(!1)).push([t.i,".page-header{flex-grow:0!important;flex-shrink:0!important;height:49.9333px!important;margin-bottom:0!important;border-bottom:0!important;border-radius:0!important;width:calc(100vw - 120px);display:flex;flex-direction:row;background:#c2cfd6;overflow:visible}",""]),t.exports=e},289:function(t,e,o){"use strict";var n={name:"PageHeader",props:{},components:{PageHeaderItem:o(280).a},methods:{}},r=(o(287),o(16)),component=Object(r.a)(n,(function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"page-header"},[this._t("default")],2)}),[],!1,null,null,null);e.a=component.exports},296:function(t,e,o){"use strict";var n=o(281);o.n(n).a},297:function(t,e,o){(e=o(31)(!1)).push([t.i,".vue-slider{padding:4px}.vue-slider-rail{background:#f0f3f5!important}.vue-slider-dot{background:#1985ac;border-radius:50%}.slider-container{display:flex;flex-direction:column;padding-left:4px;padding-right:4px}.slider-caption{height:14px;margin-bottom:4px}",""]),t.exports=e},298:function(t,e,o){"use strict";var n=o(14),r=o(42),l=o(325),h=o.n(l),d=o(280),c=o(293),f=o(309),m=o.n(f);o(8).default.use(m.a);var v={name:"PageHeaderSeek",props:{id:{type:String,default:"",required:!0}},components:{VueSlider:h.a,PageHeaderItem:d.a},beforeMount:function(){this.resetSeekPosition(),this.$root.$on(r.a.seek.get(this.id),this.getSeekPosition),this.$root.$on(r.a.seek.set(this.id),this.handleSeek),this.$root.$on(r.a.seek.reset(this.id),this.resetSeekPosition),this.$root.$on(r.a.seek.step_fw(this.id),this.stepForward),this.$root.$on(r.a.seek.step_bw(this.id),this.stepBackward)},beforeDestroy:function(){this.position=null,clearInterval(this.syncInterval),this.$root.$off(r.a.seek.get(this.id),this.getSeekPosition),this.$root.$off(r.a.seek.set(this.id),this.handleSeek),this.$root.$off(r.a.seek.reset(this.id),this.resetSeekPosition),this.$root.$off(r.a.seek.step_fw(this.id),this.stepForward),this.$root.$off(r.a.seek.step_bw(this.id),this.stepBackward)},methods:{setSeekPosition:function(){var t=this;Object(n.w)(this.id,this.position).then((function(e){t.position=e}))},handleSeek:Object(c.b)(100,!0,Object(c.a)(25,!0,(function(){this.setSeekPosition()}))),resetSeekPosition:function(){console.log("PageHeaderSeek(".concat(this.id,".resetSeek()")),this.position=null,this.handleSeek()},stepForward:function(){this.position=this.position+this.step,this.handleSeek()},stepBackward:function(){this.position=this.position-this.step,this.handleSeek()},formatTooltip:function(t){return"".concat(Math.round(100*t),"%")}},computed:{keymap:function(){return{right:this.stepForward,left:this.stepBackward}}},data:function(){return{position:null,step:.01,options:{dotSize:14,width:120,height:4,contained:!1,direction:"ltr",data:null,min:0,max:1,interval:.01,disabled:!1,clickable:!0,duration:.05,adsorb:!1,lazy:!1,tooltip:"active",tooltipPlacement:"bottom",tooltipFormatter:this.formatTooltip,useKeyboard:!0,keydownHook:null,dragOnClick:!1,enableCross:!0,fixed:!1,order:!0,marks:!1,process:!1},syncInterval:null}}},k=(o(296),o(16)),component=Object(k.a)(v,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("PageHeaderItem",[o("div",{staticClass:"slider-container"},[o("div",{staticClass:"slider-caption"},[t._v("Seek position")]),t._v(" "),o("vue-slider",t._b({ref:"slider",on:{change:t.handleSeek},model:{value:t.position,callback:function(e){t.position=e},expression:"position"}},"vue-slider",t.options,!1))],1)])}),[],!1,null,null,null);e.a=component.exports},327:function(t,e,o){var content=o(486);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(32).default)("1ff3331c",content,!0,{sourceMap:!1})},485:function(t,e,o){"use strict";var n=o(327);o.n(n).a},486:function(t,e,o){(e=o(31)(!1)).push([t.i,".align{float:left;margin:0}.align,.streamed-image-a{position:absolute;display:block;max-height:calc(100vh - 49.9333px)}.streamed-image-a{z-index:-100;pointer-events:none;max-width:calc(100vw - 120px);width:auto;height:auto}.moveable{position:absolute;width:100px;height:100px;left:0;top:0;margin:0}.hidden *{visibility:hidden}.moveable-control,.moveable-line{border-color:#1e9ecb!important;background:#20a8d8!important}.moveable-line{visibility:hidden!important}.moveable-control.moveable-rotation{border-color:#1e9ecb!important;background:#ade1f3!important}.moveable-direction,.moveable-rotation-line{visibility:visible!important;outline:1px solid transparent!important}",""]),t.exports=e},493:function(t,e,o){"use strict";o.r(e);o(2),o(1),o(4);var n=o(14),r=o(484),l=o.n(r),h=o(125),d=o(42),c=o(289),f=o(280),m=o(298),v=o(293),k=o(309),_=o.n(k);o(8).default.use(_.a);var w={name:"analyzer-align",beforeMount:function(){this.handleInit(),window.onresize=this.updateFrame},beforeDestroy:function(){this.handleSaveAlignment(),this.handleCleanUp()},components:{Moveable:l.a,PageHeader:c.a,PageHeaderItem:f.a,PageHeaderSeek:m.a},methods:{handleInit:function(){var t=this;console.log("align: handleInit()"),this.previous_id=this.id,this.opened_at=Date.now(),-1===this.$store.getters["analyzers/getIndex"](this.id)?this.$router.push("/"):(this.$root.$emit(d.a.sidebar.open(this.id)),this.align.flip=this.$store.getters["analyzers/getConfig"](this.id).transform.flip,this.waitUntilHasRect=setInterval(this.updateFrameOnceHasRect,100),Object(n.n)("transform").then((function(e){t.transform_options=e,t.transform=e[0]})),Object(n.o)(this.id).then((function(e){t.setRoi(e),t.$root.$emit(d.a.seek.reset(t.id))})),this.handleUpdate())},handleCleanUp:function(){console.log("align: handleCleanUp()"),Object(n.E)(this.previous_id,n.i.GET_INVERSE_OVERLAID_FRAME),clearInterval(this.waitUntilHasRect),this.align={frame:null,roi:null,transform:null,overlay:{width:100,height:100,top:-50,left:-50,bottom:50,right:50}},this.refs={frame:null,moveable:null}},handleClearAlignment:function(){var t=this;Object(n.h)(this.id).then((function(e){e&&Object(n.g)(t.id).then((function(e){e&&(t.setRoi(h.b),t.handleUpdate())}))}))},handleSaveAlignment:function(){Object(n.h)(this.previous_id)},handleUndoAlignment:function(){var t=this;Object(n.F)(this.id).then((function(e){t.setRoi(e)}))},handleRedoAlignment:function(){var t=this;Object(n.u)(this.id).then((function(e){t.setRoi(e)}))},getRefs:function(){console.log("filter: getRefs()"),console.log("this.ref_frame = "),console.log(this.ref_frame),console.log("this.ref_moveable = "),console.log(this.ref_moveable),console.log("this.$refs attrs = "),console.log(Object.keys(this.$refs)),console.log("this.$refs[this.ref_frame] = "),console.log(this.$refs[this.ref_frame]),console.log("this.$refs[this.ref_moveable] = "),console.log(this.$refs[this.ref_moveable]),this.refs.frame=this.$refs[this.ref_frame],this.refs.moveable=this.$refs[this.ref_moveable]},setRoi:function(t){console.log("roi"),console.log(t),this.align.roi!==t&&(Object(h.d)(t)?(console.log("is valid"),this.align.roi=t):(console.log("is invalid"),this.align.roi=h.b),this.resolveTransform())},resolveTransform:function(){console.log("handleResolveTransform"),this.align.roi&&this.align.frame&&this.align.overlay&&(console.log("roi.BL = (x: ".concat(this.align.roi.BL.x,", y: ").concat(this.align.roi.BL.y,")")),console.log("frame = "),console.log(this.align.frame),console.log("overlay = "),console.log(this.align.overlay),this.align.transform=Object(h.c)(this.align.roi,this.align.frame,this.align.overlay),this.refs.moveable.$el.style.transform=this.align.transform,this.refs.moveable.updateRect(),this.refs.moveable.updateTarget())},handleTransform:function(t){var e=t.target,o=t.transform;e.style.transform=o},handleRotate:function(t){var e=t.target,o=t.transform;e.style.transform=o},handleFlipH:function(){var t=this;this.$store.dispatch("analyzers/set_config",{id:this.id,config:{transform:{flip:[this.align.flip[0],!this.align.flip[1]]}}}).then((function(e){t.align.flip=e.transform.flip}))},handleFlipV:function(){var t=this;this.$store.dispatch("analyzers/set_config",{id:this.id,config:{transform:{flip:[!this.align.flip[0],this.align.flip[1]]}}}).then((function(e){t.align.flip=e.transform.flip}))},updateRoiCoordinates:function(){this.align.frame&&(this.align.roi=Object(h.e)(this.refs.moveable.getRect(),this.align.frame),void 0!==this.align.roi&&Object(n.j)(this.id,this.align.roi))},handleUpdate:Object(v.b)(100,!1,Object(v.a)(20,!1,(function(){this.updateRoiCoordinates()}))),updateFrame:function(){try{var t=this.refs.frame.getBoundingClientRect();this.moveable.bounds={left:t.left,right:t.right,top:t.top,bottom:t.bottom},this.align.frame=t,this.resolveTransform()}catch(t){console.log("oops @ updateFrame")}},updateFrameOnceHasRect:function(){this.getRefs();try{void 0!==this.waitUntilHasRect&&this.refs.frame.getBoundingClientRect().width>50&&(this.updateFrame(),clearInterval(this.waitUntilHasRect),this.moveable.className=this.moveableShow)}catch(t){console.log("oops @ updateFrameOnceHasRect")}},stepForward:function(){this.$root.$emit(d.a.seek.step_fw(this.id))},stepBackward:function(){this.$root.$emit(d.a.seek.step_bw(this.id))}},watch:{"$route.query.id":function(){console.log("id has changed ".concat(this.id)),this.handleCleanUp(),this.handleInit()}},computed:{id:function(){return this.$route.query.id},keymap:function(){return{"ctrl+z":this.handleUndoAlignment,"ctrl+shift+z":this.handleRedoAlignment,right:this.stepForward,left:this.stepBackward}},overlaid_url:function(){return Object(n.G)(this.$route.query.id,"stream",n.i.GET_INVERSE_OVERLAID_FRAME)},ref_frame:function(){return"align-frame-".concat(this.$route.query.id)},ref_moveable:function(){return"align-moveable-".concat(this.$route.query.id)}},data:function(){return{opened_at:0,transform_options:{},transform:"",moveable:{className:"hidden",draggable:!0,throttleDrag:0,rotatable:!0,throttleRotate:0,warpable:!0,throttleWarp:0,snappable:!0,bounds:{}},align:{frame:null,overlay:{width:100,height:100,top:-50,left:-50,bottom:50,right:50},roi:null,transform:null},refs:{frame:null,moveable:null},updateCall:null,moveableShow:"",moveableHide:"hidden",waitUntilHasRect:null,previous_id:""}}},x=(o(485),o(16)),component=Object(x.a)(w,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"fixed-page"},[o("PageHeader",[o("PageHeaderItem",[o("b-button",{staticClass:"header-button-icon",attrs:{"data-toggle":"tooltip",title:"Clear alignment"},on:{click:t.handleClearAlignment}},[o("i",{staticClass:"fa fa-remove"})]),t._v(" "),o("b-button",{directives:[{name:"hotkey",rawName:"v-hotkey",value:t.keymap,expression:"keymap"}],staticClass:"header-button-icon",attrs:{"data-toggle":"tooltip",title:"Undo alignment"},on:{click:t.handleUndoAlignment}},[o("i",{staticClass:"fa fa-undo"})]),t._v(" "),o("b-button",{directives:[{name:"hotkey",rawName:"v-hotkey",value:t.keymap,expression:"keymap"}],staticClass:"header-button-icon",attrs:{"data-toggle":"tooltip",title:"Redo alignment"},on:{click:t.handleRedoAlignment}},[o("i",{staticClass:"fa fa-repeat"})])],1),t._v(" "),o("PageHeaderItem",[o("b-button",{staticClass:"header-button-icon",attrs:{"data-toggle":"tooltip",title:"Flip horizontally"},on:{click:t.handleFlipV}},[o("i",{staticClass:"fa fa-arrows-h"})]),t._v(" "),o("b-button",{staticClass:"header-button-icon",attrs:{"data-toggle":"tooltip",title:"Flip vertically"},on:{click:t.handleFlipH}},[o("i",{staticClass:"fa fa-arrows-v"})])],1),t._v(" "),o("PageHeaderSeek",{attrs:{id:t.id}}),t._v(" "),o("PageHeaderItem",[o("b-button-group",[o("b-dropdown",{attrs:{text:""+this.transform,"data-toggle":"tooltip",title:"Transform type"}},t._l(t.transform_options,(function(e){return o("b-dropdown-item",{key:"align-"+e},[t._v("\n            "+t._s(e)+"\n          ")])})),1)],1)],1)],1),t._v(" "),o("div",{ref:"align",staticClass:"align"},[o("img",{ref:t.ref_frame,staticClass:"streamed-image-a",attrs:{src:t.overlaid_url+"?"+t.opened_at,alt:""}}),t._v(" "),o("Moveable",t._b({ref:t.ref_moveable,staticClass:"moveable",class:t.moveableHide,on:{drag:t.handleTransform,scale:t.handleTransform,rotate:t.handleRotate,warp:t.handleTransform,render:t.handleUpdate,renderEnd:t.handleSaveAlignment}},"Moveable",t.moveable,!1))],1)],1)}),[],!1,null,null,null);e.default=component.exports}}]);