(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{506:function(e,t,n){var content=n(516);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(35).default)("cda4275e",content,!0,{sourceMap:!1})},507:function(e,t,n){"use strict";function o(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=new Date(0);return t.setSeconds(e,e%1*1e3),t.toISOString().substr(14,7)}n.d(t,"a",(function(){return o}))},509:function(e,t,n){var content=n(531);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(35).default)("50ae84e0",content,!0,{sourceMap:!1})},515:function(e,t,n){"use strict";var o=n(506);n.n(o).a},516:function(e,t,n){(t=n(34)(!1)).push([e.i,".vue-slider{padding:4px}.vue-slider-rail{background:#f0f3f5!important}.vue-slider-dot{background:#1985ac;border-radius:50%}.slider-container{display:flex;flex-direction:row;padding-top:4px;padding-left:4px;padding-right:4px}.slider-caption{height:14px;margin-bottom:4px}",""]),e.exports=t},517:function(e,t,n){"use strict";var o=n(12),r=n(28),l=n(507),c=n(520),h=n.n(c),d=n(502),f=n(505),m=n(510),v=n.n(m);n(6).default.use(v.a);var y={name:"PageHeaderSeek",props:{id:{type:String,default:"",required:!0}},components:{VueSlider:h.a,PageHeaderItem:d.a},beforeMount:function(){var e=this;Object(o.y)(this.id).then((function(t){e.position=t})),Object(o.B)(this.id).then((function(t){e.totalSeconds=t})),this.$root.$on(r.a.seek.set(this.id),this.handleSeek),this.$root.$on(r.a.seek.reset(this.id),this.resetSeekPosition),this.$root.$on(r.a.seek.step_fw(this.id),this.stepForward),this.$root.$on(r.a.seek.step_bw(this.id),this.stepBackward)},beforeDestroy:function(){this.position=null,this.$root.$off(r.a.seek.set(this.id),this.handleSeek),this.$root.$off(r.a.seek.reset(this.id),this.resetSeekPosition),this.$root.$off(r.a.seek.step_fw(this.id),this.stepForward),this.$root.$off(r.a.seek.step_bw(this.id),this.stepBackward)},methods:{setSeekPosition:function(){var e=this;Object(o.H)(this.id,this.position).then((function(t){e.position=t}))},handleSeek:Object(f.b)(100,!0,Object(f.a)(25,!0,(function(){console.log("PageHeaderSeek.handleSeek()"),this.setSeekPosition()}))),resetSeekPosition:function(){console.log("PageHeaderSeek.resetSeek()"),this.position=null,this.handleSeek()},stepForward:function(){this.position=this.position+this.step,this.handleSeek()},stepBackward:function(){this.position=this.position-this.step,this.handleSeek()}},computed:{keymap:function(){return{right:this.stepForward,left:this.stepBackward}},currentTime:function(){return Object(l.a)(this.position*this.totalSeconds)},totalTime:function(){return Object(l.a)(this.totalSeconds)}},data:function(){return{position:null,step:.01,options:{dotSize:14,width:120,height:4,contained:!1,direction:"ltr",data:null,min:0,max:1,interval:.01,disabled:!1,clickable:!0,duration:.05,adsorb:!1,lazy:!1,useKeyboard:!0,keydownHook:null,dragOnClick:!1,enableCross:!0,fixed:!1,order:!0,marks:!1,process:!1},totalSeconds:0}}},w=(n(515),n(23)),component=Object(w.a)(y,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("PageHeaderItem",[n("div",{staticClass:"slider-container"},[n("div",{staticClass:"slider-caption"},[e._v(e._s(e.currentTime)+" / "+e._s(e.totalTime))]),e._v(" "),e._v("\n    â€‚\n    "),n("vue-slider",e._b({ref:"slider",on:{change:e.handleSeek},model:{value:e.position,callback:function(t){e.position=t},expression:"position"}},"vue-slider",e.options,!1))],1)])}),[],!1,null,null,null);t.a=component.exports},529:function(e,t,n){"use strict";n.d(t,"d",(function(){return f})),n.d(t,"e",(function(){return m})),n.d(t,"a",(function(){return v})),n.d(t,"b",(function(){return y})),n.d(t,"c",(function(){return w}));n(17),n(14),n(20);var o=n(31),r=n(570),l=n(19),c=n.n(l),h=["BL","TL","TR","BR"],d=["x","y"];function f(e){for(var i=0;i<h.length;i++){if(!e.hasOwnProperty(h[i]))return!1;for(var t=0;t<d.length;t++){if(!e[h[i]].hasOwnProperty(d[t]))return!1;if("number"!=typeof e[h[i]][d[t]])return!1}}return!0}function m(rect,e){try{return c()(!(null===e)),{BL:{x:(rect.pos3[0]-e.left)/e.width,y:(rect.pos3[1]-e.top)/e.height},TL:{x:(rect.pos1[0]-e.left)/e.width,y:(rect.pos1[1]-e.top)/e.height},TR:{x:(rect.pos2[0]-e.left)/e.width,y:(rect.pos2[1]-e.top)/e.height},BR:{x:(rect.pos4[0]-e.left)/e.width,y:(rect.pos4[1]-e.top)/e.height}}}catch(e){return void console.warn("roiRectInfoToCoordinates: frame is null")}}function v(e,t){var n=(e.clientX-t.left)/t.width,o=(e.clientY-t.top)/t.height;return n<0&&(n=0),n>1&&(n=1),o<0&&(o=0),o>1&&(o=1),{x:n,y:o}}function y(e,t,n){var o=v(e,n),r=v(t,n),l=Math.abs(o.x-r.x)*Math.abs(o.y-r.y);if(console.log("Area is ".concat(l)),l>.01){var c=[o.x,r.x].sort(),h=[o.y,r.y].sort();return{BL:{x:c[1],y:h[0]},TL:{x:c[1],y:h[1]},TR:{x:c[0],y:h[1]},BR:{x:c[0],y:h[0]}}}return console.warn("invalid rectangle"),null}function w(e,t,n){try{return function(e){for(var content=[],col=0;col<4;col++)for(var t=0;t<4;t++)content=[].concat(Object(o.a)(content),[e[t][col]]);return"matrix3d(".concat(content.join(","),")")}(function(e,t){for(var n,l,b,c,i,h,d,f,m,v,y,w,k=["BL","TL","TR","BR"],_=[],x=[],C=0;C<k.length;C++)_=[].concat(Object(o.a)(_),[e[k[C]]]),x=[].concat(Object(o.a)(x),[t[k[C]]]);for(console.assert(_.length===(y=x.length)&&4===y),n=[],i=h=0;h<4;i=++h)n.push([_[i].x,_[i].y,1,0,0,0,-_[i].x*x[i].x,-_[i].y*x[i].x]),n.push([0,0,0,_[i].x,_[i].y,1,-_[i].x*x[i].y,-_[i].y*x[i].y]);for(b=[],i=d=0;d<4;i=++d)b.push(x[i].x),b.push(x[i].y);for(l=[[(c=(c=Object(r.a)(n,b)).reduce((function(a,b){return a.concat(b)}),[]))[0],c[1],0,c[2]],[c[3],c[4],0,c[5]],[0,0,1,0],[c[6],c[7],0,1]],i=m=0;m<4;i=++m){f=(v=Object(r.b)(l,[_[i].x,_[i].y,0,1]))[3],w=Object(r.b)(f,[x[i].x,x[i].y,0,1]);var F=Object(r.d)(v,w);console.assert(Object(r.c)(F)<1e-9,"Not equal:",v,w)}return l}({BL:{x:(rect=n).left,y:rect.bottom},TL:{x:rect.left,y:rect.top},TR:{x:rect.right,y:rect.top},BR:{x:rect.right,y:rect.bottom}},function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0};try{var o={};return Object.keys(e).map((function(r){o[r]={x:e[r].x*t.width-n.x,y:e[r].y*t.height-n.y}})),o}catch(e){console.warn(e)}}(e,t,function(rect){return{x:rect.width/2,y:rect.height/2}}(n))))}catch(o){console.warn(o),console.warn("roi = "),console.warn(e),console.warn("frame = "),console.warn(t),console.warn("overlay = "),console.warn(n)}var rect}},530:function(e,t,n){"use strict";var o=n(509);n.n(o).a},531:function(e,t,n){(t=n(34)(!1)).push([e.i,".config-sidebar[data-v-75f0f476]{background:#fff;width:400px;float:right;max-height:calc(100vh - 38px);overflow-y:scroll;overflow-x:hidden;-ms-overflow-style:none;scrollbar-width:none}.config-sidebar[data-v-75f0f476]::-webkit-scrollbar{display:none}.sidebar-form-container[data-v-75f0f476]{width:400px}",""]),e.exports=t},534:function(e,t,n){var content=n(562);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(35).default)("45a71ca0",content,!0,{sourceMap:!1})},537:function(e,t,n){"use strict";var o=n(518),r=(n(97),n(505)),l=n(28),c={name:"ConfigSidebar",components:{SchemaForm:o.a},props:{hidden:{type:Boolean,required:!0},id:{type:String,required:!0},skip:{type:Array,required:!1,default:function(){return["frame_interval_setting","Nf","dt","video_path","design_path","features","parameters","name","description","transform"]}}},beforeMount:function(){this.handleInit()},beforeDestroy:function(){this.handleCleanUp()},methods:{handleInit:function(){this.previous_id=this.id,-1===this.$store.getters["analyzers/getIndex"](this.id)?this.$router.push("/"):(this.$root.$emit(l.a.sidebar.open(this.id)),this.edit_json=this.$store.getters["settings/getSettings"].app.edit_json,this.handleGetConfig())},handleCleanUp:function(){},handleGetConfig:function(){console.log("configure.hangleGetConfig()"),this.config=this.$store.getters["analyzers/getAnalyzerConfigCopy"](this.id)},handleSetConfig:function(){var e=this;this.$store.dispatch("analyzers/set_config",{id:this.id,config:this.config}).then((function(){e.config=e.$store.getters["analyzers/getAnalyzerConfigCopy"](e.id)}))},handleUpdate:Object(r.b)(250,!1,Object(r.a)(50,!1,(function(){this.handleSetConfig()})))},watch:{"$route.query.id":function(){console.log("id has changed ".concat(this.id)),this.handleCleanUp(),this.handleInit()}},computed:{schema:function(){var e=this.$store.getters["schemas/getConfigSchema"];return e}},data:function(){return{config:{},ui_schema:[]}}},h=(n(530),n(23)),component=Object(h.a)(c,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"config-sidebar"},[this.config?t("SchemaForm",{staticClass:"config-form-container",attrs:{data:this.config,schema:this.schema,skip:this.skip,property_as_title:!0},on:{input:this.handleUpdate}}):this._e()],1)}),[],!1,null,"75f0f476",null);t.a=component.exports},561:function(e,t,n){"use strict";var o=n(534);n.n(o).a},562:function(e,t,n){(t=n(34)(!1)).push([e.i,".filter{z-index:100;margin:0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none}.streamed-image-f{max-width:calc(100vw - 120px);max-height:calc(100vh - 38px)}.streamed-image-f,.streamed-image-f-cs{display:inline;width:auto;height:auto;float:left;position:absolute;pointer-events:none}.streamed-image-f-cs{max-width:calc(100vw - 520px);max-height:calc(100vh - 438px)}.overlay{opacity:.25}.overlay,.overlay-state{mix-blend-mode:multiply;pointer-events:none;float:left;max-height:calc(100vh - 38px)}.hidden *{visibility:hidden}.filter-content{display:flex;flex-direction:row}.filter-placeholder{flex-grow:1;height:calc(100vh - 38px)}",""]),e.exports=t},576:function(e,t,n){"use strict";n.r(t);n(36),n(17),n(14),n(20);var o=n(12),r=n(28),l=n(508),c=n(502),h=n(517),d=n(537),f=n(529),m=(n(97),n(6)),v=n(199);m.default.use(v.a);var y={name:"analyzer-filter",beforeMount:function(){this.handleInit(),window.onresize=this.updateFrame},beforeDestroy:function(){this.handleCleanUp()},components:{PageHeader:l.a,PageHeaderItem:c.a,PageHeaderSeek:h.a,ConfigSidebar:d.a},methods:{handleInit:function(){console.log("filter: handleInit()"),this.previous_id=this.id,this.$store.dispatch("analyzers/refresh",{id:this.id}),this.opened_at=Date.now(),-1===this.$store.getters["analyzers/getIndex"](this.id)?this.$router.push("/"):(this.$root.$emit(r.a.sidebar.open(this.id)),this.$store.dispatch("analyzers/get_config",{id:this.id}),this.waitUntilHasRect=setInterval(this.updateFrameOnceHasRect,100),this.waitForMasks=setInterval(this.getMasks,100),this.waitForFeatures=setInterval(this.getFeatures,100))},handleCleanUp:function(){console.log("filter: handleCleanUp()"),Object(o.Q)(this.previous_id,o.m.GET_FRAME),Object(o.Q)(this.previous_id,o.m.GET_STATE_FRAME),clearInterval(this.waitUntilHasRect),clearInterval(this.waitForFeatures),clearInterval(this.waitForMasks),this.filter={frame:null},this.refs={frame:null}},getRefs:function(){console.log("filter: getRefs()"),console.log("this.ref_frame = "),console.log(this.ref_frame),console.log("this.$refs attrs = "),console.log(Object.keys(this.$refs)),console.log("this.$refs[this.ref_frame] = "),console.log(this.$refs[this.ref_frame]),this.refs.frame=this.$refs[this.ref_frame]},getFeatures:function(){console.log("filter: getFeatures()"),this.features=this.$store.getters["analyzers/getFeatures"](this.id),this.feature=this.features[0],0!==this.features.length&&(console.log("filter: getFeatures() -- clearing interval"),clearInterval(this.waitForFeatures)),console.log(this.features)},updateFrame:function(){console.log("filter: updateFrame");try{var e=this.refs.frame.getBoundingClientRect();console.log(e),this.filter.frame=e}catch(e){console.warn(e)}},updateFrameOnChange:function(){console.log("filter: updateFrameOnChange");for(var e=this.refs.frame.getBoundingClientRect().width;this.refs.frame.getBoundingClientRect().width===e;)console.log("frame is still the same");console.log("frame has changed"),this.updateFrame()},updateFrameOnceHasRect:function(){var e=!1;this.getRefs(),void 0!==this.waitUntilHasRect&&this.refs.frame.getBoundingClientRect().width>50&&(console.log("HAS FRAME"),this.updateFrame(),e=!0),e&&clearInterval(this.waitUntilHasRect)},handleClick:function(e){Object(o.L)(this.id,Object(f.a)(e,this.filter.frame)).then((function(data){data.message&&console.log("//PUT THIS IN A POPUP OR SOMETHING// ".concat(data.message))}))},handleSetMask:function(mask,e){console.log("filter: handleSetMask()"),console.log(mask),console.log(e),this.mask=e},handleSetFilter:function(filter,e){this.config.masks[this.mask].filter.type=filter,this.$store.dispatch("analyzers/set_config",{id:this.id,config:this.config})},handleClearFilters:function(){console.warn("NOT IMPLEMENTED YET")},handleUndoFilters:function(){Object(o.T)(this.id,"masks")},handleRedoFilters:function(){Object(o.F)(this.id,"masks")},stepForward:function(){this.$root.$emit(r.a.seek.step_fw(this.id))},stepBackward:function(){this.$root.$emit(r.a.seek.step_bw(this.id))},handleHideConfigSidebar:function(){this.hideConfigSidebar=!this.hideConfigSidebar,this.waitUntilHasRect=setInterval(this.updateFrameOnceHasRect,100)}},watch:{"$route.query.id":function(){console.log("id has changed ".concat(this.id)),this.handleCleanUp(),this.handleInit(),this.updateFrame()},"refs.frame.class":function(){console.log("waaa this is a change")}},asyncComputed:{},computed:{id:function(){return this.$route.query.id},state_url:function(){return Object(o.d)(this.$route.query.id,"stream",o.m.GET_STATE_FRAME)},frame_url:function(){return Object(o.d)(this.$route.query.id,"stream",o.m.GET_FRAME)},overlay_url:function(){return Object(o.d)(this.$route.query.id,"call",o.m.GET_OVERLAY_PNG)},ref_frame:function(){return"filter-frame-".concat(this.$route.query.id)},keymap:function(){return{"ctrl+z":this.handleUndoFilters,"ctrl+shift+z":this.handleRedoFilters,right:this.stepForward,left:this.stepBackward}},config:function(){return this.$store.getters["analyzers/getAnalyzerConfig"](this.$route.query.id)},masks:function(){return void 0!==this.config?this.config.masks.map((function(e){return e.name})):[]},filter_options:function(){return console.log('this.$store.getters["schemas/getFilterOptions"]'),console.log(this.$store.getters["schemas/getFilterOptions"]),this.$store.getters["schemas/getFilterOptions"]},filter_type:function(){return void 0!==this.config?this.config.masks[this.mask].filter.type:void 0}},data:function(){return{opened_at:0,waitUntilHasRect:null,waitForMasks:null,waitForFeatures:null,mask:0,filter:{frame:null},refs:{frame:null},hideConfigSidebar:!0,hideVideoFrame:!1}}},w=(n(561),n(23)),component=Object(w.a)(y,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"fixed-page"},[n("PageHeader",[n("PageHeaderItem",[n("b-button",{staticClass:"header-button-icon",attrs:{"data-toggle":"tooltip",title:"Clear alignment"},on:{click:e.handleClearFilters}},[n("i",{staticClass:"icon-ban"})]),e._v(" "),n("b-button",{directives:[{name:"hotkey",rawName:"v-hotkey",value:e.keymap,expression:"keymap"}],staticClass:"header-button-icon",attrs:{"data-toggle":"tooltip",title:"Undo alignment"},on:{click:e.handleUndoFilters}},[n("i",{staticClass:"icon-action-undo"})]),e._v(" "),n("b-button",{directives:[{name:"hotkey",rawName:"v-hotkey",value:e.keymap,expression:"keymap"}],staticClass:"header-button-icon",attrs:{"data-toggle":"tooltip",title:"Redo alignment"},on:{click:e.handleRedoFilters}},[n("i",{staticClass:"icon-action-redo"})])],1),e._v(" "),n("PageHeaderSeek",{key:e.id,attrs:{id:e.id}}),e._v(" "),n("PageHeaderItem",[n("b-button",{on:{click:function(t){e.hideVideoFrame=!e.hideVideoFrame}}},[e._v("\n        "+e._s(e.hideVideoFrame?"Show video frame":"Hide video frame")+"\n      ")])],1)],1),e._v(" "),n("div",{staticClass:"filter-content"},[e.hideConfigSidebar?e._e():n("ConfigSidebar",{attrs:{id:this.id,hidden:!0,skip:["frame_interval_setting","Nf","dt","video_path","design_path","design","features","feature_parameters","name","description","transform"]}}),e._v(" "),n("div",{staticClass:"filter filter-placeholder",on:{click:e.handleClick}},[e.hideVideoFrame?e._e():n("img",{ref:e.ref_frame,class:e.hideConfigSidebar?"streamed-image-f":"streamed-image-f-cs",attrs:{src:e.frame_url+"?"+e.opened_at,alt:""}}),e._v(" "),n("img",{staticClass:"overlay",class:e.hideConfigSidebar?"streamed-image-f":"streamed-image-f-cs",attrs:{src:e.overlay_url+"?"+e.opened_at,alt:""}}),e._v(" "),n("img",{staticClass:"overlay-state",class:e.hideConfigSidebar?"streamed-image-f":"streamed-image-f-cs",attrs:{src:e.state_url+"?"+e.opened_at,alt:""}})])],1)],1)}),[],!1,null,null,null);t.default=component.exports}}]);